name: "roam-to-git tests.py"

on: [push, pull_request]


jobs:
  test:
    strategy:
      fail-fast: false
      matrix:
        os: [ubuntu-latest]
        python: [ 3.8, 3.9 ]

    env:
      OS: ${{ matrix.os }}
      PYTHON: ${{ matrix.python }}

    runs-on: ${{ matrix.os }}
    name: Test
    timeout-minutes: 15

    steps:
    # - run: sudo apt-get update && apt install -y gconf-service libasound2 libatk1.0-0 libc6 libcairo2 libcups2 libdbus-1-3 libexpat1 libfontconfig1 libgcc1 libgconf-2-4 libgdk-pixbuf2.0-0 libglib2.0-0 libgtk-3-0 libnspr4 libpango-1.0-0 libpangocairo-1.0-0 libstdc++6 libx11-6 libx11-xcb1 libxcb1 libxcomposite1 libxcursor1 libxdamage1 libxext6 libxfixes3 libxi6 libxrandr2 libxrender1 libxss1 libxtst6 ca-certificates fonts-liberation libappindicator1 libnss3 lsb-release xdg-utils wget
    - uses: actions/checkout@v2

    - name: Set up Python
      uses: actions/setup-python@v2
      with:
        python-version: ${{ matrix.python }}

    - name: Setup firefox
      uses: browser-actions/setup-firefox@v1
      with:
        firefox-version: latest
    - run: |
        echo Installed firefox versions: ${{ steps.setup-firefox.outputs.firefox-version }}
        firefox --version

    - name: Setup dependencies
      run: |
        python --version
        python -m pip install -r requirements.txt
        python -m pip install mypy

    - name: Run backup
      run: ./tests.py
